<!doctype html><html lang="ko"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ë°ˆ ë©”ì´ì»¤ (ë“œë˜ê·¸/ì €ì¥)</title>
<style>
:root{--bg:#0b1220;--card:#111827;--line:#1f2937;--ink:#e5e7eb}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,Arial}
.wrap{max-width:980px;margin:20px auto;padding:16px}
.grid{display:grid;gap:12px}@media(min-width:860px){.grid{grid-template-columns:1.2fr .8fr}}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px}
label{display:block;font-size:12px;margin:6px 0 4px;color:#c7d2fe}
input[type="text"],input[type="number"],select{width:100%;background:#0f172a;border:1px solid #334155;color:var(--ink);border-radius:8px;padding:10px 12px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
button{border:0;border-radius:10px;background:#2563eb;color:#fff;padding:12px 16px;font-weight:700;cursor:pointer}
.btn-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.help{color:#93c5fd;font-size:12px;margin-top:8px}
canvas{width:100%;height:auto;display:block;background:#0f172a;border:1px dashed #334155;border-radius:12px}
.drop{padding:16px;border:2px dashed #334155;border-radius:12px;text-align:center;color:#9ca3af}
.active{border-color:#60a5fa;color:#bfdbfe}
.small{font-size:12px;color:#9ca3af}
.tag{display:inline-block;background:#0f172a;border:1px solid #334155;border-radius:8px;padding:6px 8px;margin-right:6px}
</style>

<div class="wrap">
  <div class="grid">
    <div class="card">
      <canvas id="cv" width="1200" height="900"></canvas>
      <div class="help">ğŸ’¡ ìº”ë²„ìŠ¤ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ <b>ë“œë˜ê·¸</b>í•´ ìœ„ì¹˜ë¥¼ ë°”ê¿€ ìˆ˜ ìˆì–´ìš”. (ëª¨ë°”ì¼ í„°ì¹˜ ì§€ì›)</div>
    </div>

    <div class="card">
      <div id="drop" class="drop">ì´ë¯¸ì§€ë¥¼ ì—¬ê¸°ë¡œ ë“œë˜ê·¸í•˜ê±°ë‚˜, ì•„ë˜ì—ì„œ íŒŒì¼ ì„ íƒ</div>
      <label>ì´ë¯¸ì§€ ì„ íƒ</label>
      <input id="file" type="file" accept="image/*">

      <div class="row" style="margin-top:10px">
        <div>
          <label>í°íŠ¸</label>
          <select id="font">
            <option>Impact</option><option>Pretendard</option><option>Arial</option><option>Nanum Gothic</option>
          </select>
        </div>
        <div>
          <label>êµµê¸°</label>
          <select id="weight"><option>900</option><option selected>700</option><option>600</option></select>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <div>
          <label>í¬ê¸°(px)</label>
          <input id="size" type="number" value="72" min="12" max="300">
        </div>
        <div>
          <label>í…Œë‘ë¦¬ ë‘ê»˜</label>
          <input id="stroke" type="number" value="6" min="0" max="40">
        </div>
      </div>

      <label style="margin-top:10px">ìƒë‹¨ í…ìŠ¤íŠ¸</label>
      <input id="topText" type="text" placeholder="ìƒë‹¨ í…ìŠ¤íŠ¸ ì…ë ¥">

      <label style="margin-top:6px">í•˜ë‹¨ í…ìŠ¤íŠ¸</label>
      <input id="bottomText" type="text" placeholder="í•˜ë‹¨ í…ìŠ¤íŠ¸ ì…ë ¥">

      <div class="btn-row">
        <button id="swap">ìƒ/í•˜ í…ìŠ¤íŠ¸ ìœ„ì¹˜ ë°”ê¾¸ê¸°</button>
        <button id="clear">í…ìŠ¤íŠ¸ ì§€ìš°ê¸°</button>
        <button id="save">ì´ë¯¸ì§€ ì €ì¥</button>
      </div>

      <div class="help">
        <span class="tag">í´ë¦­/ë“œë˜ê·¸: í…ìŠ¤íŠ¸ ì´ë™</span>
        <span class="tag">ë”ë¸”í´ë¦­: í…ìŠ¤íŠ¸ ì„ íƒ í† ê¸€</span>
        <div class="small">ì €ì¥ ì‹œ ë¸Œë¼ìš°ì € ë‹¤ìš´ë¡œë“œê°€ ì—´ë¦½ë‹ˆë‹¤. iOS ì‚¬íŒŒë¦¬ì—ì„œëŠ” ìƒˆ íƒ­ìœ¼ë¡œ ì—´ë¦´ ìˆ˜ ìˆì–´ìš”.</div>
      </div>
    </div>
  </div>
</div>

<script>
const cv = document.getElementById('cv'), ctx = cv.getContext('2d');
const file = document.getElementById('file');
const drop = document.getElementById('drop');
const topText = document.getElementById('topText');
const bottomText = document.getElementById('bottomText');
const fontSel = document.getElementById('font');
const weightSel = document.getElementById('weight');
const sizeInp = document.getElementById('size');
const strokeInp = document.getElementById('stroke');
const swapBtn = document.getElementById('swap');
const clearBtn = document.getElementById('clear');
const saveBtn = document.getElementById('save');

let img = new Image(), hasImg = false;
let state = {
  top:   { x: 0.5, y: 0.1, text: '', selected:false },
  bottom:{ x: 0.5, y: 0.9, text: '', selected:false }
};
let dragging = null;

function fmtFont(){
  const sz = +sizeInp.value||72;
  const fw = weightSel.value||'700';
  const ff = fontSel.value||'Impact';
  return `${fw} ${sz}px "${ff}", Impact, Arial, sans-serif`;
}
function draw(){
  // ë°°ê²½
  ctx.fillStyle = '#0f172a';
  ctx.fillRect(0,0,cv.width,cv.height);
  if (hasImg) {
    // ì´ë¯¸ì§€ê°€ ìº”ë²„ìŠ¤ì— ê½‰ ì°¨ë„ë¡(ë ˆí„°ë°•ìŠ¤ ìµœì†Œí™”)
    const iw = img.naturalWidth, ih = img.naturalHeight;
    const cw = cv.width, ch = cv.height;
    const ir = iw/ih, cr = cw/ch;
    let w, h, x, y;
    if (ir > cr){ // ê°€ë¡œê°€ ë” ê¹€
      w = cw; h = w/ir; x = 0; y = (ch - h)/2;
    } else {
      h = ch; w = h*ir; y = 0; x = (cw - w)/2;
    }
    ctx.drawImage(img, x, y, w, h);
  }

  // í…ìŠ¤íŠ¸
  const font = fmtFont();
  const strokeW = +strokeInp.value||0;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.lineJoin = 'round';
  ctx.font = font;

  function drawOne(obj){
    if(!obj.text) return;
    const x = cv.width * obj.x;
    const y = cv.height * obj.y;
    if (strokeW>0){ ctx.lineWidth = strokeW; ctx.strokeStyle = 'black'; ctx.strokeText(obj.text, x, y); }
    ctx.fillStyle = 'white';
    ctx.fillText(obj.text, x, y);

    // ì„ íƒ í‘œì‹œ
    if (obj.selected){
      const m = ctx.measureText(obj.text);
      const w = m.width + 24, h = (+sizeInp.value||72) + 16;
      ctx.strokeStyle = 'rgba(96,165,250,.9)';
      ctx.lineWidth = 2;
      ctx.strokeRect(x - w/2, y - h/2, w, h);
    }
  }
  drawOne(state.top);
  drawOne(state.bottom);
}

function loadFile(f){
  if (!f) return;
  const r = new FileReader();
  r.onload = e => { img = new Image(); img.onload=()=>{ hasImg=true; draw() }; img.src = e.target.result; };
  r.readAsDataURL(f);
}

file.addEventListener('change', e => loadFile(e.target.files[0]));
['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev, e=>{e.preventDefault(); drop.classList.add('active')}))
;['dragleave','drop'].forEach(ev=>drop.addEventListener(ev, e=>{e.preventDefault(); drop.classList.remove('active')}))
drop.addEventListener('drop', e => { const f = e.dataTransfer.files?.[0]; loadFile(f); });

[topText, bottomText, fontSel, weightSel, sizeInp, strokeInp].forEach(el=>el.addEventListener('input', ()=>{
  state.top.text = topText.value;
  state.bottom.text = bottomText.value;
  draw();
}));

swapBtn.onclick = ()=>{ const tmp = { ...state.top }; state.top = { ...state.bottom }; state.bottom = tmp;
  topText.value = state.top.text; bottomText.value = state.bottom.text; draw(); };

clearBtn.onclick = ()=>{ topText.value=''; bottomText.value=''; state.top.text=''; state.bottom.text=''; draw(); };

saveBtn.onclick = ()=>{
  if (!hasImg) return alert('ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì˜¬ë ¤ì£¼ì„¸ìš”.');
  const a = document.createElement('a');
  a.href = cv.toDataURL('image/png');
  a.download = 'meme.png';
  // iOS/Safari ëŒ€ì‘
  if (typeof a.download === 'string'){ a.click(); }
  else { window.open(a.href, '_blank'); }
};

// ì¢Œí‘œ ìœ í‹¸
function posFromEvent(e){
  const r = cv.getBoundingClientRect();
  const cx = (e.touches? e.touches[0].clientX : e.clientX) - r.left;
  const cy = (e.touches? e.touches[0].clientY : e.clientY) - r.top;
  return { x: cx / r.width, y: cy / r.height };
}
function hitTest(p, obj){
  if(!obj.text) return false;
  ctx.font = fmtFont();
  const m = ctx.measureText(obj.text);
  const w = m.width + 24, h = (+sizeInp.value||72) + 16;
  const x = cv.width * obj.x, y = cv.height * obj.y;
  const rx = x - w/2, ry = y - h/2;
  const px = p.x * cv.width, py = p.y * cv.height;
  return (px>=rx && px<=rx+w && py>=ry && py<=ry+h);
}

// ë“œë˜ê·¸/ì„ íƒ
function down(e){
  const p = posFromEvent(e);
  // ì–´ë–¤ í…ìŠ¤íŠ¸ë¥¼ ì¡ì•˜ëŠ”ì§€ íŒì • (ìš°ì„ ìˆœìœ„: ìœ„->ì•„ë˜)
  let target = null;
  if (hitTest(p, state.top)) target = 'top';
  else if (hitTest(p, state.bottom)) target = 'bottom';

  state.top.selected = state.bottom.selected = false;
  if (target){ state[target].selected = true; dragging = target; }
  draw();
}
function move(e){
  if(!dragging) return;
  const p = posFromEvent(e);
  const obj = state[dragging];
  obj.x = Math.min(.98, Math.max(.02, p.x));
  obj.y = Math.min(.98, Math.max(.02, p.y));
  draw();
}
function up(){ dragging = null; }

cv.addEventListener('mousedown', down);
cv.addEventListener('mousemove', move);
window.addEventListener('mouseup', up);
cv.addEventListener('touchstart', e=>{down(e);}, {passive:false});
cv.addEventListener('touchmove', e=>{move(e); e.preventDefault();}, {passive:false});
window.addEventListener('touchend', up);

// ì´ˆê¸° ë Œë”
draw();
</script>
</html>
