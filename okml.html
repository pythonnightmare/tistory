<!doctype html><html lang="ko"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>오목 SAFE (고정 900x900)</title>
<style>
body{margin:0;display:grid;place-items:center;min-height:100vh;background:#111;color:#e5e7eb;font-family:system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,Arial}
.wrap{padding:16px;background:#0f172a;border:1px solid #243042;border-radius:14px;box-shadow:0 10px 28px rgba(0,0,0,.35)}
h1{font-size:18px;margin:0 0 10px}
.row{display:flex;gap:8px;margin-bottom:10px}
button,select{border:0;border-radius:10px;background:#2563eb;color:#fff;padding:10px 14px;font-weight:700;cursor:pointer}
button.sec{background:#374151}
.badge{padding:6px 10px;border-radius:999px;background:#0b1220;border:1px solid #334155}
canvas{display:block;background:#f7efd9;border:1px solid #111827;border-radius:12px}
</style>

<div class="wrap">
  <h1>오목 SAFE</h1>
  <div class="row">
    <button id="new">새 게임</button>
    <button id="undo" class="sec">되돌리기</button>
    <select id="mode"><option value="pvp">사람 vs 사람</option><option value="ai">사람 vs AI</option></select>
    <span class="badge" id="status">흑 선공</span>
  </div>
  <!-- 고정 크기 캔버스: 레이아웃/반응형 영향 없음 -->
  <canvas id="cv" width="900" height="900"></canvas>
</div>

<script>
const N=15, MARGIN=40, STAR=[3,7,11], BLACK=1, WHITE=2, RATIO=0.42;
const cv=document.getElementById('cv'), ctx=cv.getContext('2d');
const statusEl=document.getElementById('status'), modeSel=document.getElementById('mode');
let board, turn, over, moves, winLine=null;

function clear(){ ctx.clearRect(0,0,cv.width,cv.height); }
function cellSize(){ return (cv.width - MARGIN*2)/(N-1); }
function cellCenter(gx,gy){ const s=cellSize(); return {x:MARGIN+gx*s, y:MARGIN+gy*s, s}; }
function pxToCell(px,py){ const s=cellSize(); const gx=Math.round((px-MARGIN)/s), gy=Math.round((py-MARGIN)/s); return {gx,gy}; }

function drawBoard(){
  clear();
  const g=ctx.createLinearGradient(0,0,cv.width,cv.height); g.addColorStop(0,'#f7efd9'); g.addColorStop(1,'#f0e2bf');
  ctx.fillStyle=g; ctx.fillRect(0,0,cv.width,cv.height);

  ctx.strokeStyle='#111827'; ctx.lineWidth=2;
  const s=cellSize();
  for(let i=0;i<N;i++){
    ctx.beginPath(); ctx.moveTo(MARGIN, MARGIN+i*s); ctx.lineTo(MARGIN+(N-1)*s, MARGIN+i*s); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(MARGIN+i*s, MARGIN); ctx.lineTo(MARGIN+i*s, MARGIN+(N-1)*s); ctx.stroke();
  }
  ctx.fillStyle='#0b1220';
  STAR.forEach(ix=>STAR.forEach(iy=>{ const {x,y}=cellCenter(ix,iy); ctx.beginPath(); ctx.arc(x,y,4,0,Math.PI*2); ctx.fill(); }));

  for(let y=0;y<N;y++)for(let x=0;x<N;x++) if(board[y][x]) drawStone(x,y,board[y][x]);
  if(winLine) drawWinLine(winLine);
}
function drawStone(gx,gy,col){
  const {x,y,s}=cellCenter(gx,gy); const r=s*RATIO;
  const gr=ctx.createRadialGradient(x-r*0.3,y-r*0.3,r*0.2,x,y,r);
  if(col===BLACK){ gr.addColorStop(0,'#6b7280'); gr.addColorStop(1,'#111827'); }
  else{ gr.addColorStop(0,'#fff'); gr.addColorStop(1,'#d1d5db'); }
  ctx.fillStyle=gr; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
  ctx.lineWidth=1.6; ctx.strokeStyle='rgba(0,0,0,.35)'; ctx.stroke();
}
function drawWinLine(line){
  ctx.save(); ctx.strokeStyle='#22c55e'; ctx.lineWidth=5; ctx.lineJoin='round'; ctx.lineCap='round';
  for(let i=0;i<line.length-1;i++){ const a=cellCenter(line[i][0],line[i][1]), b=cellCenter(line[i+1][0],line[i+1][1]);
    ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); }
  ctx.restore();
}
function checkWin(gx,gy,c){
  const dirs=[[1,0],[0,1],[1,1],[1,-1]];
  for(const [dx,dy] of dirs){
    let cnt=1, line=[[gx,gy]], x=gx+dx, y=gy+dy;
    while(x>=0&&x<N&&y>=0&&y<N&&board[y][x]===c){ line.push([x,y]); cnt++; x+=dx; y+=dy; }
    x=gx-dx; y=gy-dy;
    while(x>=0&&x<N&&y>=0&&y<N&&board[y][x]===c){ line.unshift([x,y]); cnt++; x-=dx; y-=dy; }
    if(cnt>=5) return line;
  }
  return null;
}
function reset(){ board=Array.from({length:N},()=>Array(N).fill(0)); turn=BLACK; over=false; moves=[]; winLine=null; statusEl.textContent='흑 선공'; drawBoard(); }
function place(gx,gy,byAI=false){
  if(over||gx<0||gx>=N||gy<0||gy>=N||board[gy][gx]) return;
  board[gy][gx]=turn; moves.push([gx,gy,turn]); drawStone(gx,gy,turn);
  const line=checkWin(gx,gy,turn);
  if(line){ over=true; winLine=line; drawBoard(); statusEl.textContent=(turn===BLACK?'흑':'백')+' 승리!'; return; }
  turn=(turn===BLACK?WHITE:BLACK);
  statusEl.textContent=(turn===BLACK?'흑 차례':'백 차례')+(modeSel.value==='ai'&&turn===WHITE?' (AI)':'');
  if(modeSel.value==='ai' && !over && turn===WHITE && !byAI) setTimeout(aiMove,120);
}
function undo(){
  if(!moves.length || (over && winLine)){ winLine=null; over=false; }
  if(!moves.length) return;
  const last=moves.pop(); board[last[1]][last[0]]=0; turn=last[2]; drawBoard();
  statusEl.textContent=(turn===BLACK?'흑 차례':'백 차례')+(modeSel.value==='ai'&&turn===WHITE?' (AI)':'');
}
function aiMove(){
  const me=WHITE, opp=BLACK;
  function tryWin(col){
    for(let y=0;y<N;y++)for(let x=0;x<N;x++){
      if(board[y][x]) continue;
      board[y][x]=col; const ok=!!checkWin(x,y,col); board[y][x]=0;
      if(ok) return [x,y];
    } return null;
  }
  let mv=tryWin(me)||tryWin(opp);
  if(!mv){
    const cand=[]; for(let y=0;y<N;y++)for(let x=0;x<N;x++){
      if(board[y][x]) continue; let near=0;
      for(let dy=-2;dy<=2;dy++)for(let dx=-2;dx<=2;dx++){
        const ny=y+dy,nx=x+dx; if(nx>=0&&nx<N&&ny>=0&&ny<N&&board[ny][nx]) near++;
      } if(near>0) cand.push({x,y,w:near});
    }
    if(cand.length){
      const sum=cand.reduce((a,c)=>a+c.w,0); let r=Math.random()*sum;
      for(const c of cand){ r-=c.w; if(r<=0){ mv=[c.x,c.y]; break; } }
      if(!mv){ const c=cand[Math.floor(Math.random()*cand.length)]; mv=[c.x,c.y]; }
    } else mv=[7,7];
  }
  if(mv) place(mv[0],mv[1],true);
}

cv.addEventListener('click', e=>{ const r=cv.getBoundingClientRect(); const x=e.clientX-r.left, y=e.clientY-r.top; const c=pxToCell(x,y); place(c.gx,c.gy); });
cv.addEventListener('touchstart', e=>{ const t=e.touches[0], r=cv.getBoundingClientRect(); const c=pxToCell(t.clientX-r.left, t.clientY-r.top); place(c.gx,c.gy); },{passive:true});
document.getElementById('new').onclick=reset;
document.getElementById('undo').onclick=undo;
modeSel.onchange=()=>{ statusEl.textContent=(turn===BLACK?'흑 차례':'백 차례')+(modeSel.value==='ai'&&turn===WHITE?' (AI)':''); };

reset();
</script>
</html>
